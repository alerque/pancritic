<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Kolen Cheung" />
  <title>Using CriticMarkup with pandoc</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="pandoc-criticmarkup.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">Using CriticMarkup with pandoc</h1>
<h2 class="author">Kolen Cheung</h2>
</div>
<p>Using CriticMarkup with pandoc---not a filter but a preprocessor.</p>
<h1 id="caveats">Caveats</h1>
<p>The way this script works depends on the fact that pandoc allows RAW HTML and RAW LaTeX in the markdown source. The CriticMarkup is transformed into either a RAW HTML or RAW LaTeX representations (specified by the command line arguments).</p>
<p>Because of the asymmetry in the way pandoc handle RAW HTML and RAW LaTeX (namely, markdown inside RAW HTML are parsed, but not in RAW LaTeX), markdown within the CriticMarkup will not be rendered in LaTeX output. This filter might help if you want to change that: <a href="https://gist.github.com/mpickering/f1718fcdc4c56273ed52">LaTeX Argument Parser</a>.</p>
<p>Another caveat is that nesting CriticMarkup might have unexpected behavior, especially in LaTeX output. For example, the <a href="test.md" class="uri">test.md</a> file do not have a valid LaTeX output because of nesting CriticMarkup.</p>
<p>Lastly, see <a href="http://criticmarkup.com/spec.php#caveats">the caveats section in the spec of CriticMarkup</a>.</p>
<h1 id="definition-of-criticmarkup">Definition of CriticMarkup</h1>
<ul>
<li>Deletions: This is a test.</li>
<li>Additions: This is a test.</li>
<li>Substitutions: This is a test.</li>
<li>Highlighting: This is a test.</li>
<li>Comments: This is a test<!-- What is a test for? -->.</li>
</ul>
<h1 id="the-scripts">The Scripts</h1>
<p>These scripts are supposed to be in the same folder:</p>
<ul>
<li><code>criticmarkup-accept.py</code></li>
<li><code>criticmarkup-reject.py</code></li>
<li><code>pandoc-criticmarkup.sh</code></li>
</ul>
<p>The <code>criticmarkup-accept.py</code> and <code>criticmarkup-reject.py</code> are extracted from the OS X System Services from <a href="http://criticmarkup.com/services.php">CriticMarkup Toolkit</a>.</p>
<h2 id="note-on-latex-output-usepackage-required">Note on LaTeX Output: Usepackage Required</h2>
<p>Note that the latex output requires the LaTeX packages <code>color</code> and <code>soul</code>. As you can see from this markdown file, I used a hack to guarantee your pandoc standard template also use them, like this: <code>fontfamily: lmodern,color,soul</code>.</p>
<p>In my personal use, I have an YAML of <code>usepackage: [color,soul]</code> that in my template will added <code>\usepackage{color,soul}</code>. See <a href="https://github.com/ickc/pandoc-templates/tree/latex-usepackage-hyperref">ickc/pandoc-templates at latex-usepackage-hyperref</a> for details.</p>
<h1 id="usage">Usage</h1>
<p><code>pandoc-criticmarkup.sh [options...] [file]</code></p>
<p>Options:</p>
<ul>
<li>accept: <code>-a</code></li>
<li>reject: <code>-r</code></li>
<li>permanent: <code>-p</code></li>
<li>show diff: <code>-d</code>
<ul>
<li><code>-d html</code>: targeting html output using RAW HTML</li>
<li><code>-d latex</code>: targeting LaTeX output using RAW LaTeX</li>
<li><code>-d pdf</code>: same as above</li>
</ul></li>
</ul>
<p>If permanent is used, it will overwrite the original, if not, it will output to <code>stdout</code>. In most situation permanent should be used with <code>-a</code> or <code>-r</code> only, but it can be used with <code>-d</code> as well.</p>
<p><code>-a</code>, <code>-r</code>, <code>-d</code> are supposed to use separately:</p>
<ul>
<li>If <code>-d</code> is used, the others are ignored,</li>
<li>if <code>-r</code> is used, <code>-a</code> is ignored</li>
</ul>
<p>It can be used with the pandoc commands, like these (see <code>build.sh</code> for more examples):</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## Showing Difference and not overwriting</span>
<span class="kw">./pandoc-criticmarkup.sh</span> -d html README.md <span class="kw">|</span> <span class="kw">pandoc</span> -s -o README.html
<span class="kw">./pandoc-criticmarkup.sh</span> -d pdf README.md <span class="kw">|</span> <span class="kw">pandoc</span> -s -o README.pdf
<span class="co">## accept or reject while overwriting the source</span>
<span class="kw">./pandoc-criticmarkup.sh</span> -ap README-accept.md
<span class="kw">./pandoc-criticmarkup.sh</span> -rp README-reject.md</code></pre></div>
<h1 id="todo">Todo</h1>
<ul>
<li>add a minimal CSS (especially for the HTML aside element)</li>
</ul>
<h1 id="appendix">Appendix</h1>
<h2 id="css">CSS</h2>
<p>An optional CSS <code>pandoc-criticmarkup.css</code> make the deletions and additions more obvious in HTML output.</p>
<h2 id="mapping-for-showing-differences">Mapping for Showing Differences</h2>
<table>
<thead>
<tr class="header">
<th>critic markup</th>
<th>HTML</th>
<th>LaTeX</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>`<code>|</code><del>[text]</del><code>|</code>` |<br />
<code>[text]</code> | <code>&lt;ins&gt;[text]&lt;/ins&gt;</code> | <code>\underline{[text]}</code> |<br />
<code>[text2]</code> | <code>&lt;del&gt;[text1]&lt;/del&gt;&lt;ins&gt;[text2]&lt;/ins&gt;</code> | <code>\st{[text1]}\underline{[text2]}</code> |<br />
<code>[text]</code> | <code>&lt;mark&gt;[text]&lt;/mark&gt;</code> | <code>\hl{[text]}</code> |<br />
<code>&lt;!-- [text] --&gt;</code> | <code>&lt;aside&gt;[text]&lt;/aside&gt;</code> | <code>\marginpar{[text]}</code> |</p>
<h2 id="test-files-from-mmd">Test Files From MMD</h2>
<p><a href="test.md" class="uri">test.md</a> is from <a href="https://github.com/fletcher/MMD-Test-Suite/blob/master/CriticMarkup/Critic.text">MMD-Test-Suite/Critic.text at master Â· fletcher/MMD-Test-Suite</a></p>
</body>
</html>
